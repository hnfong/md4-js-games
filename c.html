<html>
 <head>
  <title>Lonely Island</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <script src="util.js" type="text/javascript"></script>
  <script src="network.js" type="text/javascript"></script>
  <script src="game.js" type="text/javascript"></script>
  <script src="board.js" type="text/javascript"></script>
  <script src="ui.js" type="text/javascript"></script>
  <script src="player.js" type="text/javascript"></script>
  <script type="text/javascript" src="geom.js"></script>
 </head>
<body>


<table>
 <tr>
  <td>
   <img src="img/transparent.gif" id="board_interface" style="width:600px; height: 600px; border: 0; position: absolute; left: 0px; top: -120px; z-index: 100" usemap="#cellmap" />
  </td>
 </tr>
</table>

<map name="cellmap" id="cellmap"></map>
<map name="vertexmap" id="vertexmap"></map>
<map name="edgemap" id="edgemap"></map>

<div id="tiles"></div>
<div id="roads"></div>
<div id="buildings"></div>
<div id="markers"></div>
<div id="robber" style="position:absolute;visibility:hidden;"><img src="img/robber.gif"/></div>

<div id="player_window" class="window" style="left: 600px; top: 20px;"></div>
<div id="dice" class="dice" style="left: 700px; top: 300px;" onmousedown="state.diceHandler();"><img src="img/dice1.png"><img src="img/dice6.png"></div>
<div id="steal_window" class="window" style="left: 700px; top: 500px;visibility:hidden;">Steal from:</div>

<div id="purchase_window" class="window" style="left: 770px; top: 20px;"></div>
<div id="res_window" style="left: 770px; top: 250px;"></div>
<input type="button" value="End Turn" class="window" style="left: 770px; top: 350px;" onclick="state.buttonHandler('button_end_turn');"/>
<div id="log_window" class="window" style="left: 770px; top: 380px; width: 200px; height: 100px; overflow: auto;">Welcome to Lonely Island~</div>
<div id="devcard_window" class="window" style="left: 770px; top: 500px;">Development Cards:</div>

<div id="status" class="window" style="left: 300px; top: 500px;">Status: idle</div>
<div style="top: 500px; position: absolute">
<div onmousedown="regPlayer('cx',0); board.randomizeCells(); devCards.shuffle(); game.start(new Array('cx', 'Si', 'phisho')); priv_sendMapData(); priv_startGame();">I am player 0</div>
<div onmousedown="regPlayer('Si',1);">I am player 1</div>
<div onmousedown="regPlayer('cychoi',2);">I am player 2</div>
<div onmousedown="clearRemoteLog();">Clear Data</div>
</div>

</body>

<script language="javascript" src="state.js"></script>
<script language="javascript" src="remote.js"></script>
<script language="javascript" src="devcard.js"></script>

<script language="javascript">

//////////////////////////////////////////////////////// BEGIN CONFIG AND CONSTANTS

var game = new Game();
var board = new Board();

var preGamePlayerNames = new Array();

var myId;
var initRolls;
var tiedPlayers;
var firstPlayer;
var initialSett;


//////////////////////////////////////////// BEGIN action functions

function cat_initRoll(pid) {
	var a = roll();
	var txt = '';
	var outcome = 0;
	for (var i = 0; i < game.numDice; ++i) {
		txt += a[i] + ' ';
		outcome += a[i];
	}
	initRolls[pid] = outcome;
	// determine next roller
	var index = 0;
	for (var i = 0; i < tiedPlayers.length; ++i)
		if (tiedPlayers[i] == pid)
			index = i;
	if (index < tiedPlayers.length - 1)
		return tiedPlayers[index+1];
	return -1;
}

function cat_initRollFinishRound() {
	var highest = 0;
	for (var i = 0; i < tiedPlayers.length; ++i)
		if (initRolls[tiedPlayers[i]] > highest)
			highest = initRolls[tiedPlayers[i]];
	var newTiedPlayers = new Array();
	for (var i = 0; i < tiedPlayers.length; ++i)
		if (initRolls[tiedPlayers[i]] == highest)
			newTiedPlayers.push(tiedPlayers[i]);
	tiedPlayers = newTiedPlayers;
	if (tiedPlayers.length == 1)
		return firstPlayer = tiedPlayers[0];
	else
		return -1;
}

function priv_sendMapData() {
	var s = '';
	s += 'map_data ' + myId + ' ' + board.WIDTH + ' ' + board.HEIGHT;
	s += ' ' + dumpArray(board.data);
	s += ' ' + dumpArray(board.cellResources);
	s += ' ' + dumpArray(board.cellMarkers);
	s += ' ' + board.robberPos.i + ' ' + board.robberPos.j;
	sendRemoteMessage(s);

	s = 'card_data';
	for (var i = 0 ; i < devCards.length; i++){
		s += ' ' + devCards[i].id;
	}
	sendRemoteMessage(s);
}

function priv_startGame() {
	sendRemoteMessage('start_game 0');
}


function regPlayer(name, id) {
	myId = id;
	sendRemoteMessage('register ' + id + ' ' + name);
}

window.onload = function() {
	devCardsStatic.populate();
	receiveRemoteMessages();
};

</script>

</html>
