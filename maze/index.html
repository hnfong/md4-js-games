<head>
<script>
function newArray(r, c) {
	var a = new Array(r);
	for (var i=0;i<r;++i) {
		a[i] = new Array(c);
		for (var j=0;j<c;++j)
			a[i][j] = 0;
	}
	return a;
}

function copyArray(arr) {
	var a = new Array(arr.length);
	for (var i=0;i<a.length;++i) {
		a[i] = new Array(arr[i].length);
		for (var j=0;j<a[i].length;++j)
			a[i][j] = arr[i][j];
	}
	return a;
}

var dx = [-1,0,1,0];
var dy = [0,-1,0,1];

</script>
</head>
<body>
<h2>Finding cx</h2>
<p>Use arrow keys to move.</p>
<div id="mazeContainer" style="border-bottom: 1px solid black; position:absolute;">
</div>

<script>

var rows = 60, cols = 60, size = 10;
var visited = newArray(rows, cols);
var edges = newArray(rows, cols);
var q = [ { x: 0, y: 0} ];
visited[0][0] = 1;
var solution = [];

function countPossible(x,y) {
	var possible = [];
	for (var i=0;i<4;++i) {
		var xx = x + dx[i], yy = y + dy[i];
		if (xx>=0&&yy>=0&&xx<cols&&yy<rows&&visited[xx][yy]==0)
			possible.push(i);
	}
	return possible;
}

// Maze generation: Recursive backtracker
while (q.length) {
	var xy = q[q.length-1];
	var possible = countPossible(xy.x, xy.y);
	if (possible.length) {
		var k = Math.floor(Math.random()*possible.length);
		var dir = possible[k];
		var xx = xy.x + dx[dir], yy = xy.y + dy[dir];
		edges[xy.x][xy.y] += (1 << dir);
		edges[xx][yy] += (1 << ((dir+2)%4));
		q.push( { x: xx, y: yy } );
		visited[xx][yy] = 1;
		if (xx==cols-1&&yy==rows-1) { // store solution
			for (var i=0;i<q.length;++i) {
				solution.push(q[i]);
			}
		}
	} else {
		q.pop();
	}
}

// Create the DIVs, place them, and set borders

var container = document.getElementById('mazeContainer');
container.style.width = (size * cols) + 'px';
container.style.height = (size * rows) + 'px';

for (var i=0;i<cols;++i) {
	for (var j=0;j<rows;++j) {
		var div = document.createElement('DIV');
		div.id = 'cell_' + i + '_' + j;
		div.style.left = (i*size) + 'px';
		div.style.top = (j*size) + 'px';
		div.style.position = 'absolute';
		div.style.height = '9px';
		div.style.width = '9px';
		// set borders....
		div.style.border = '1px solid black';
		if (edges[i][j] & 1) div.style.borderLeft = '1px solid transparent';
		if (edges[i][j] & 2) div.style.borderTop = '1px solid transparent';
		if (edges[i][j] & 4) div.style.borderRight = '1px solid transparent';
		if (edges[i][j] & 8) div.style.borderBottom = '1px solid transparent';
		
		container.appendChild(div);
	}
}

// paint solution
for (var i=0;i<solution.length;++i) {
	var o = document.getElementById('cell_'+solution[i].x+'_'+solution[i].y);
	o.style.background = '#ccffcc';
}

var heroX = 0;
var heroY = 0;
var hero = document.createElement('DIV');
hero.style.width = '7px';
hero.style.height = '7px';
hero.style.left = (heroX*10+2)+'px';
hero.style.top = (heroY*10+2)+'px';
hero.style.background = 'red';
hero.style.position = 'absolute';
hero.style.zIndex = 3000;
container.appendChild(hero);

var goalX = cols-1;
var goalY = rows-1;
var goal = document.createElement('DIV');
goal.style.width = '7px';
goal.style.height = '7px';
goal.style.left = (goalX*10+2)+'px';
goal.style.top = (goalY*10+2)+'px';
goal.style.background = 'blue';
goal.style.position = 'absolute';
goal.style.zIndex = 2000;
container.appendChild(goal);


function handleKeydown(e) {
	if (e.keyCode == 37) // left
		if (edges[heroX][heroY] & 1) { heroX--; update(); }
	if (e.keyCode == 38) // up
		if (edges[heroX][heroY] & 2) { heroY--; update(); }
	if (e.keyCode == 39) // right
		if (edges[heroX][heroY] & 4) { heroX++; update(); }
	if (e.keyCode == 40) // down
		if (edges[heroX][heroY] & 8) { heroY++; update(); }
	if (heroX == goalX && heroY == goalY) {
		alert('Congratulations!');
		window.removeEventListener('keydown', handleKeydown, true);
	}
}

function update() {
	hero.style.left = (heroX*10+2)+'px';
	hero.style.top = (heroY*10+2)+'px';
	hero2.style.left = (heroX*10+2)+'px';
	hero2.style.top = (heroY*10+2)+'px';
}

window.addEventListener('keydown', handleKeydown, true);

</script>
</body>
